# 1. 单表查询

## 1.1 基础语法SELECT

### 单列查询

```sql
SELECT [列名] FROM [表名];
```

### 多列查询

```sql
SELECT [列名1],[列名2] FROM [表名];
```

### 所有列查询

```sql
SELECT * FROM [表名];
```

## 1.2 结果展示

> **注意：**
>
> + 引号的使用（中文）
> + NULL的处理
> + 该语句不影响原表数据

### 别名设置

```sql
SELECT [列名] AS [别名] FROM [表名];
```

> 适合场景：
>
> + 当前列名不符合规定，重新命名
> + 新生成的列

### 常数添加

```sql
SELECT '常数' AS [别名] FROM [表名];
```

> 适合场景：
>
> + 添加特点值

### 四则运算

```sql
SELECT [四则运算表达式] FROM [表名];
```

> 适合场景：
>
> + 需要一定计算

### 字符拼接：CONCAT

```sql
SELECT CONCAT([列名1],'+',[列名2]) FROM [表名];
```

> 适合场景：
>
> + 组合多列信息为一列
> + 对列的信息进行补充

### 指定拼接符：CONCAT_WS

```sql
SELECT CONCAT_WS('拼接符',[列名1],[列名2]) FROM [表名];
```

> 适合场景：
>
> + 多字段拼接，字段间使用同样的拼接符
> + **会自动跳过NULL**

### 内容去重：DISTINCT

```sql
SELECT DISTINCT [列名] FROM [表名];
```

> 适合场景：
>
> + 列中有多个相同值，想查看值的种类

## 1.3 结果排序ORDER BY

> 注意：
>
> + **SELECT语句的最后一条子句**
> + 文本格式的顺序
> + 排序列可以不显示

### 排序方式（列的选择）

+ **单列排序**

```sql
... ORDER BY [列名];
```

+ **多列排序**

```sql
... ORDER BY [列名1],[列名2];
```

+ **列位置排序**

```sql
... ORDER BY [列位置1],[列位置2];
```

### 排序顺序（升序、降序、中文）

+ **升序排序**

  ```sql
  ... ASC;
  ```

+ **降序排序**

  ```sql
  ... DESC;
  ```

+ **中文按字典顺序排序**

```sql
... ORDER BY CONVERT([列名] USING gbk);
```

## 1.4 数据过滤WHERE

> 注意：
>
> + 位于FROM之后，ORDER之前
> + 过滤条件为文本格式的数值，大小比较
> + NULL的处理

过滤条件

+ 常规运算符：= | <> | != | < | <= | > | >= 
+ 计算表达式：列与常数，列与列

### NULL的处理

```sql
WHERE IFNULL([列名],[替代值]) = 1;
```

### 数值过滤

```sql
WHERE [列名] BETWEEN [前端值] AND [后端值];
```

> 适合场景：
>
> + 简化取值范围的书写
> + 两端均包含

### 空值过滤

```sql
WHERE [列名] IS NULL;
```

> 使用场景：
>
> + 异常值处理

### 非空值过滤

```sql
WHERE [列名] IS NOT NULL;
```

> 使用场景：
>
> + 异常值处理

### 模糊查询LIKE

> 注意：
>
> + 通配符开头，查询效率低
> + 转义符 \ 的使用

+ 通配符：_

  ```sql
  WHERE [列名] LIKE '..._...';
  ```

  > 使用场景：
  >
  > + **知道字符数目**
  > + 知道字符位置

+ 通配符：%

  ```sql
  WHERE [列名] LIKE '...%...';
  ```

  > 使用场景：
  >
  > + **不知道字符数目**
  > + 知道字符位置

### 且AND / 或OR

+ **且AND**

  ```sql
  WHERE [条件1] AND [条件2] AND ...；
  ```

  > 使用场景：
  >
  > + 不止一个过滤条件
  > + 所有条件需要同时满足

+ **或OR**

  ```sql
  WHERE [条件1] OR [条件2] OR ...；
  ```

  > 使用场景：
  >
  > + 不止一个过滤条件
  > + 满足一个条件即可

+ **组合操作**

  ```sql
  WHERE [条件1] AND [条件2] OR ...；
  ```

  > 注意：确定优先级，尽量使用（）

### 取值限制：IN

```sql
WHERE [字段] IN (值1，值2);
```

> 使用场景：
>
> + 过滤值明确
> + 不是联系范围

### 否定条件：NOT

```sql
WHERE NOT [条件1];
```

> 使用场景：
>
> + 否定一个或多个过滤条件
> + 不能单独使用
> + 类似补集的概念
> + 只否定紧跟着的条件

## 1.5 数据类型

### INTEGER

定义：整数型。只能存储整数

```sql
INTEGER
INTEGER(10) #10为显示宽度
```

### DEMICAL

定义：定点型。存储固定位数的小数

```sql
DEMICAL(2,2) #（长度，小数点后位数）
DEMICAL(4,2)
DEMICAL(10,0) #默认
```

> 用于精确计算，比如金额
>
> 多出位数四舍五入

### FLOAT/DOUBLE/REAL

定义：浮点型。存储不定位数的小数

```sql
FLOAT(5,3)
DOUBLE
REAL
```

> 多出位数五舍六入

## 1.6 数值函数

### 绝对值函数：ABS

```sql
ABS(-3)=3
```

### 平方根函数：SQRT

```sql
SQRT(4)=2
```

### 指数函数：EXP

```SQL
EXP(4)=e^4
```

### 四舍五入函数：ROUND

```sql
ROUND(1.2345,2)=1.23
```

### 圆周率函数：PI

```sql
PI()=π
```

### 字符长度：CHAR_LENGTH

```sql
CHAR_LENGTH('数据')=2
```

### 字节数：LENGTH

```sql
LENGTH('数据')=6
```

### 去除右边空值：RTRIM

```sql
RTRIM('HOME   ')='HOME'
```

### 去除左边空值：LTRIM

```sql
LTRIM('    HOME')='HOME'
```

### 大小写切换

+ **大写字母UPPER**

  ```sql
  UPPER('home')='HOME'
  ```

+ 小写字母LOWER

  ```sql
  LOWER('HOME')='home'
  ```

## 1.7 时间函数

### 获取具体日期段：YEAR/MONTH/DAY

```sql
SELECT DAY('2019-01-25')='25'
```

### 获取具体时间段：HOUR/MINUTE/SECOND

```SQL
SELECT SECOND('14:01')='0'
SELECT SECOND('14:01:22')='22'
```

### 获取月份名称：MONTHNAME

```SQL
SELECT MONTHNAME('2019-2-10')='February'
```

### 获取当前日期时间：NOW

```SQL
SELECT NOW()='2021-11-14 22:18:23'
```

### 获取当前日期：CURDATE

```sql
SELECT CURDATE()='2021-11-14'
```

### 获取当前时间：CURTIME

```sql
SELECT CURTIME()='22:19:25'
```

### 时间增加：DATE_ADD

```sql
SELECT DATE_ADD('2019-05-01',INTERVAL 1 MONTH)='2019-06-01'
```

### 时间减少：DATE_SUB

```sql
SELECT DATE_SUB(NOW(),INTERVAL 1 MONTH)='2021-10-14 22:39:42'
```

## 1.8 聚合函数

### 计数：COUNT

```sql
#计算表中行数
COUNT(*)
COUNT(1)

COUNT(col) #只作用于非空行，不可同时计数多列

COUNT(DISTINCT col) #对行去重计数
```

### 求和：SUM

+ 区别于直接四则运算
+ 只数值型作用
+ 可同时操作多个列
+ 可作用于计算表达式

### 均值：AVG

+ 分母不对NULL计数
+ 可同时操作多个列

### 最大值：MAX

+ 适用于数值型、日期型、文本型
+ 要求该列可排序
+ 忽略NULL
+ DISTINCT无意义

### 最小值：MIN

+ 适用于数值型、日期型、文本型
+ 要求该列可排序
+ 忽略NULL
+ DISTINCT无意义

## 1.9 分组函数：GROUP BY

```sql
SELECT [聚合键] [分组列] | [聚合函数] | [常数] FROM [表名] WHERE [过滤条件] GROUP BY [聚合键];
```

> 结果中一行数据即代表一个分组
>
> SELECT展示列必须与分组对应，只能是聚合键
>
> NULL值单独成为一个分组
>
> 聚合键尽量不要出现别名

### 分组过滤：HAVING

```sql
SELECT ... FROM ... WHERE [行过滤条件] GROUP BY ... HAVING [组过滤条件（聚合函数）];
```

> 一定在GROUP BY之后
>
> WHERE 指定行过滤条件
>
> HAVING 指定组过滤条件
>
> 分组之前过滤的行不参与分组过滤
>
> 可使用聚合函数

## 1.10 执行顺序

FROM ... > WHERE ... > GROUP BY ... > HAVING ... > SELECT ... > ORDER BY ...

# 2. 多表查询

## 2.1 标量子查询

子查询：嵌套在其他查询中的查询（可多层嵌套，影响性能）

标量子查询：只返回**一行一列**（即一个单元格的数据）的**子查询**，相当于一个常数

## 2.2 关联子查询

关联子查询：返回**一列结果**的**子查询**，与主查询目标列存在一定关联，适用于组内比较

## 2.3 表联结

联结：**关联多个表**，返回一组输出，在一条SELECT语句中实现

主键：唯一标识。可以是ID或任意其他唯一值

联结：不是物理实体，在实际的数据库表中不存在

```sql
SELECT [列名] FROM [表1],[表2] WHERE [表1].[列a] = [表2].[列b] ;
```

> 必须完全限定列名，否则会出现二义性，返回错误

### 内部联结：INNER JOIN

联结前提：必须有共同列

联结结果：所有表的所有列、共同列重复的行

创建联结规则：INNER JOIN 列出所有表、ON 定义所有表关系（[表1].[列a] = [表2].[列b]）

优点：相比子查询嵌套，性能更好，且可以从多个表中选择结果字段

### 自联结：INNER JOIN

联结前提：联结表为同一个

联结结果：返回所有数据

创建联结规则：INNER JOIN 为表起两个别名、ON 定义所有表关系（[表别名1].[列a] = [表别名2].[列a]）

### 外部联结：OUTER JOIN

联结前提：必须有共同列

联结结果：所有表的所有列、包含相关表中没有关联行的行

创建联结规则：列出所有表、定义所有表关系（[表1].[列a] = [表2].[列b]）

+ LEFT OUTER JOIN：包含左边表的所有行
+ RIGHT OUTER JOIN：包含右边表的所有行
+ FULL OUTER JOIN：包含两边表的所有行

## 2.4 组合查询：UNION

```sql
SELECT [] FROM []
UNION
SELECT [] FROM []
ORDER BY ;
```

作用：将两条SELECT结果组合在一起

> 注意：
>
> + 两条及两条以上SELECT语句，每两条之间UNION一次
> + SELECT 相同的列、表达式或聚集函数
> + SELECT 列的数据类型必须兼容（允许隐式转换）
> + SELECT 最终字段名由第一条SELECT语句决定
> + ORDER BY 写在最后一条SELECT语句中，作用于整个检索结果

# 3. 增删改

## 3.1 数据插入 INSERT INTO	

# 4. 表操作

# 5. 虚拟表：视图

视图：一个镜像，本身不包含数据。若源数据发生改变，镜像也发生改变

## 5.1 视图操作

+ 创建一个视图

```sql
CREATE VIEW [视图名] AS [表名] ;
```

> 视图可以嵌套（可以是个联结后的大表）
>
> ORDER BY 无意义，部分DBMS禁止
>
> 视图名唯一，字段名唯一

+ 删除视图

```sql
DROP VIEW [视图名];
```

+ 作用
  + 简化代码：方便语句重用、实现数据过滤、隐藏复杂语句，如联结

